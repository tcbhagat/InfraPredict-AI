<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfraPredict AI - Maintenance Schedule Optimizer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Basic table styling for uploaded data */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .data-table th, .data-table td {
            border: 1px solid #e2e8f0; /* Tailwind's gray-200 */
            padding: 0.75rem;
            text-align: left;
            font-size: 0.875rem; /* sm text size */
        }
        .data-table th {
            background-color: #f8fafc; /* Tailwind's gray-50 */
            font-weight: 600;
            color: #4a5568; /* Tailwind's gray-700 */
        }
        .data-table tbody tr:nth-child(even) {
            background-color: #fbfdff; /* Slightly different background for even rows */
        }
        .data-table tbody tr:hover {
            background-color: #eff6ff; /* Tailwind's blue-50 on hover */
        }
        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px auto; /* Center and add some space */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-lg">
        <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center">
            <h1 class="text-3xl font-bold mb-2 sm:mb-0">InfraPredict AI</h1>
            <nav>
                <ul class="flex space-x-4">
                    <li><a href="#" class="hover:text-blue-200 transition duration-300">Dashboard</a></li>
                    <li><a href="#" class="hover:text-blue-200 transition duration-300">Data Upload</a></li>
                    <li><a href="#" class="hover:text-blue-200 transition duration-300">Reports</a></li>
                    <li><a href="#" class="hover:text-blue-200 transition duration-300">Settings</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto p-4 flex-grow grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">

        <!-- Left Panel: Data Ingestion & Input -->
        <section class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md flex flex-col">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">Data Input & Upload</h2>
            <div class="flex-grow">
                <!-- File Upload Section -->
                <div class="mb-6">
                    <label for="file-upload" class="block text-gray-700 text-sm font-medium mb-2">Upload Inspection Data (CSV/Excel)</label>
                    <div class="flex items-center justify-center w-full">
                        <label for="file-upload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition duration-300">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-8 h-8 mb-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                <p class="mb-2 text-sm text-gray-500"><span class="font-semibold" id="file-upload-text">Click to upload</span> or drag and drop</p>
                                <p class="text-xs text-gray-500">CSV, XLSX (MAX. 10MB)</p>
                            </div>
                            <input id="file-upload" type="file" class="hidden" accept=".csv, .xlsx, .xls" />
                        </label>
                    </div>
                    <p id="file-name" class="text-sm text-gray-600 mt-2 hidden">Selected file: <span class="font-medium"></span></p>
                </div>

                <!-- Manual Data Input Section -->
                <div class="mb-6">
                    <label for="manual-input" class="block text-gray-700 text-sm font-medium mb-2">Manual Data Input (e.g., Environmental Factors)</label>
                    <textarea id="manual-input" rows="6" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md p-3 resize-y" placeholder="Enter environmental data, specific asset details, or other relevant information..."></textarea>
                </div>

                <!-- Analyze Button -->
                <button id="analyze-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105">
                    Analyze Data
                </button>
            </div>
        </section>

        <!-- Middle Panel: AI Analysis Results -->
        <section class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md flex flex-col">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">AI Analysis & Predictions</h2>
            <div class="flex-grow overflow-y-auto max-h-[70vh]"> <!-- Added max-height and overflow for scrollability -->
                <div id="ai-results" class="text-gray-700 leading-relaxed">
                    <!-- Initial Placeholder for AI generated content -->
                    <div id="initial-ai-placeholder">
                        <p class="text-gray-500 italic mb-4">AI analysis results will appear here after data processing. This section will include:</p>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-6">
                            <li>Summary of inspection reports and identified defects.</li>
                            <li>Correlation with environmental data and its potential impact.</li>
                            <li>Predicted degradation patterns for assets.</li>
                            <li>Recommended optimal maintenance timings and types.</li>
                        </ul>

                        <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded-md mb-4" role="alert">
                            <p class="font-bold">Awaiting Data</p>
                            <p>Please upload or input data and click 'Analyze Data' to see the predictions.</p>
                        </div>
                    </div>

                    <!-- Section to display uploaded data -->
                    <div id="uploaded-data-display" class="hidden">
                        <h3 class="text-xl font-semibold text-gray-700 mb-3">Uploaded Data Preview:</h3>
                        <div class="overflow-x-auto rounded-lg border border-gray-200">
                            <table id="data-table-preview" class="data-table">
                                <!-- Table headers and rows will be inserted here by JavaScript -->
                            </table>
                        </div>
                    </div>

                    <!-- Loading indicator -->
                    <div id="loading-indicator" class="hidden flex flex-col items-center justify-center p-8">
                        <div class="loader"></div>
                        <p class="text-gray-600 mt-2">Analyzing data with AI... Please wait.</p>
                    </div>

                    <!-- AI generated content will be rendered here -->
                    <div id="ai-generated-content" class="hidden">
                        <!-- Content dynamically inserted by JavaScript -->
                    </div>
                </div>
            </div>
            <!-- Report Generation Button -->
            <button class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105">
                Generate Detailed Report
            </button>
        </section>

    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-4 mt-6">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 InfraPredict AI. All rights reserved. Leveraging free AI agents for smarter infrastructure.
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileUploadInput = document.getElementById('file-upload');
            const fileNameDisplay = document.getElementById('file-name');
            const fileUploadText = document.getElementById('file-upload-text');
            const analyzeButton = document.getElementById('analyze-button');
            const manualInputTextarea = document.getElementById('manual-input');
            const aiResultsDiv = document.getElementById('ai-results');
            const initialAiPlaceholder = document.getElementById('initial-ai-placeholder');
            const uploadedDataDisplay = document.getElementById('uploaded-data-display');
            const dataTablePreview = document.getElementById('data-table-preview');
            const aiGeneratedContentDiv = document.getElementById('ai-generated-content');
            const loadingIndicator = document.getElementById('loading-indicator');

            let uploadedCsvData = null;

            // Handle file selection
            fileUploadInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    fileNameDisplay.querySelector('span').textContent = file.name;
                    fileNameDisplay.classList.remove('hidden');
                    fileUploadText.textContent = 'File selected';
                    // Check file type and size
                    if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                        if (file.size <= 10 * 1024 * 1024) { // 10MB limit
                            readCSVFile(file);
                        } else {
                            alert('File size exceeds 10MB limit. Please upload a smaller file.');
                            fileUploadInput.value = ''; // Clear the input
                            fileNameDisplay.classList.add('hidden');
                            fileUploadText.textContent = 'Click to upload';
                        }
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        alert('Excel file support is not yet implemented. Please upload a CSV file.');
                        fileUploadInput.value = ''; // Clear the input
                        fileNameDisplay.classList.add('hidden');
                        fileUploadText.textContent = 'Click to upload';
                    } else {
                        alert('Unsupported file type. Please upload a CSV or Excel file.');
                        fileUploadInput.value = ''; // Clear the input
                        fileNameDisplay.classList.add('hidden');
                        fileUploadText.textContent = 'Click to upload';
                    }
                } else {
                    fileNameDisplay.classList.add('hidden');
                    fileUploadText.textContent = 'Click to upload';
                }
            });

            // Function to read and parse CSV file
            function readCSVFile(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const csvText = e.target.result;
                    try {
                        uploadedCsvData = parseCSV(csvText);
                        displayCSVData(uploadedCsvData);
                    } catch (error) {
                        console.error("Error parsing CSV:", error);
                        alert("Error parsing CSV file. Please ensure it's a valid CSV format.");
                        uploadedCsvData = null;
                        uploadedDataDisplay.classList.add('hidden');
                        initialAiPlaceholder.classList.remove('hidden');
                    }
                };
                reader.onerror = () => {
                    alert('Failed to read file.');
                    uploadedCsvData = null;
                    uploadedDataDisplay.classList.add('hidden');
                    initialAiPlaceholder.classList.remove('hidden');
                };
                reader.readAsText(file);
            }

            // Simple CSV parser (handles basic comma-separated values)
            function parseCSV(csvString) {
                const lines = csvString.split(/\r?\n/).filter(line => line.trim() !== ''); // Split by new line and remove empty lines
                if (lines.length === 0) {
                    throw new Error("CSV file is empty.");
                }

                const headers = lines[0].split(',').map(header => header.trim());
                const data = [];

                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(value => value.trim());
                    if (values.length === headers.length) { // Ensure row has correct number of columns
                        const rowObject = {};
                        headers.forEach((header, index) => {
                            rowObject[header] = values[index];
                        });
                        data.push(rowObject);
                    } else {
                        console.warn(`Skipping malformed row ${i + 1}: ${lines[i]}`);
                    }
                }
                return { headers, data };
            }

            // Function to display parsed CSV data in a table
            function displayCSVData(data) {
                // Clear previous content
                dataTablePreview.innerHTML = '';

                // Create table header
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                data.headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                dataTablePreview.appendChild(thead);

                // Create table body
                const tbody = document.createElement('tbody');
                data.data.forEach(rowData => {
                    const tr = document.createElement('tr');
                    data.headers.forEach(header => {
                        const td = document.createElement('td');
                        td.textContent = rowData[header];
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                dataTablePreview.appendChild(tbody);

                // Show the uploaded data display and hide the initial placeholder
                initialAiPlaceholder.classList.add('hidden');
                uploadedDataDisplay.classList.remove('hidden');
            }

            // Function to display AI results
            function displayAIResults(results) {
                aiGeneratedContentDiv.innerHTML = ''; // Clear previous results
                aiGeneratedContentDiv.classList.remove('hidden');

                if (results.summary) {
                    const summaryHtml = `
                        <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded-md mb-4">
                            <p class="font-bold mb-2">Analysis Summary:</p>
                            <p>${results.summary}</p>
                        </div>
                    `;
                    aiGeneratedContentDiv.insertAdjacentHTML('beforeend', summaryHtml);
                }

                if (results.degradationPredictions && results.degradationPredictions.length > 0) {
                    let predictionsHtml = `
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded-md mb-4">
                            <p class="font-bold mb-2">Predicted Degradation Patterns:</p>
                            <ul class="list-disc list-inside space-y-1">
                    `;
                    results.degradationPredictions.forEach(prediction => {
                        predictionsHtml += `<li><strong>${prediction.asset}:</strong> ${prediction.prediction} <br> <span class="text-sm italic">${prediction.recommendation}</span></li>`;
                    });
                    predictionsHtml += `</ul></div>`;
                    aiGeneratedContentDiv.insertAdjacentHTML('beforeend', predictionsHtml);
                }

                if (results.maintenanceSchedule && results.maintenanceSchedule.length > 0) {
                    let scheduleHtml = `
                        <div class="bg-green-50 border-l-4 border-green-400 text-green-800 p-4 rounded-md mb-4">
                            <p class="font-bold mb-2">Optimized Maintenance Schedule:</p>
                            <ul class="list-disc list-inside space-y-1">
                    `;
                    results.maintenanceSchedule.forEach(item => {
                        scheduleHtml += `<li><strong>Asset: ${item.asset}</strong> - ${item.action} (Urgency: ${item.urgency}, Cost: ${item.cost}) - Recommended by: ${item.dueDate}</li>`;
                    });
                    scheduleHtml += `</ul>`;
                    if (results.scheduleConstraints) {
                        scheduleHtml += `<p class="mt-2 text-sm">Considered constraints: ${results.scheduleConstraints}</p>`;
                    }
                    scheduleHtml += `</div>`;
                    aiGeneratedContentDiv.insertAdjacentHTML('beforeend', scheduleHtml);
                }

                if (!results.summary && (!results.degradationPredictions || results.degradationPredictions.length === 0) && (!results.maintenanceSchedule || results.maintenanceSchedule.length === 0)) {
                    aiGeneratedContentDiv.innerHTML = `
                        <div class="bg-gray-50 border-l-4 border-gray-400 text-gray-800 p-4 rounded-md mb-4" role="alert">
                            <p class="font-bold">No Specific AI Results</p>
                            <p>The AI processed the data but did not generate specific degradation predictions or maintenance schedules based on the input provided. Please refine your input or try different data.</p>
                        </div>
                    `;
                }

                aiResultsDiv.scrollIntoView({ behavior: 'smooth' });
            }


            // Handle Analyze Data button click for AI integration
            analyzeButton.addEventListener('click', async () => {
                const manualInputText = manualInputTextarea.value;

                if (!uploadedCsvData && manualInputText.trim() === '') {
                    alert('Please upload a CSV/Excel file or enter manual data to analyze.');
                    return;
                }

                // Show loading indicator and hide previous content
                initialAiPlaceholder.classList.add('hidden');
                uploadedDataDisplay.classList.add('hidden');
                aiGeneratedContentDiv.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');

                let rawResponseText = ''; // Variable to store raw response text

                try {
                    // Construct the prompt for the AI
                    let prompt = "Analyze the following civil infrastructure asset data and provide:\n";
                    prompt += "1. A summary of inspection reports, identified defects, and critical issues.\n";
                    prompt += "2. Correlation with environmental data and its potential impact on asset degradation.\n";
                    prompt += "3. Predicted degradation patterns for assets, including estimated critical failure points and recommendations.\n";
                    prompt += "4. An optimized maintenance schedule, considering urgency, cost-effectiveness, preventive vs. corrective actions, and user-defined constraints.\n";
                    prompt += "Provide the output in a JSON format with the following schema. Ensure the entire JSON object is returned and is properly closed with a '}'. Do not truncate the response:\n";
                    prompt += "{\n";
                    prompt += "  \"summary\": \"[Overall summary of findings]\",\n";
                    prompt += "  \"degradationPredictions\": [\n";
                    prompt += "    { \"asset\": \"[Asset ID/Name]\", \"prediction\": \"[Degradation prediction]\", \"recommendation\": \"[Recommended action]\" }\n";
                    prompt += "  ],\n";
                    prompt += "  \"maintenanceSchedule\": [\n";
                    prompt += "    { \"asset\": \"[Asset ID/Name]\", \"action\": \"[Maintenance action]\", \"urgency\": \"[High/Medium/Low]\", \"cost\": \"[High/Medium/Low]\", \"dueDate\": \"[Recommended due date]\" }\n";
                    prompt += "  ],\n";
                    prompt += "  \"scheduleConstraints\": \"[Constraints considered, e.g., budget, resources]\"\n";
                    prompt += "}\n\n";

                    if (uploadedCsvData) {
                        prompt += "--- Uploaded Inspection Data (CSV Format) ---\n";
                        prompt += "Headers: " + uploadedCsvData.headers.join(', ') + "\n";
                        uploadedCsvData.data.forEach(row => {
                            prompt += Object.values(row).join(', ') + "\n";
                        });
                        prompt += "\n";
                    }

                    if (manualInputText.trim() !== '') {
                        prompt += "--- Manual Input / Environmental Factors ---\n";
                        prompt += manualInputText.trim() + "\n\n";
                    }

                    console.log("Sending prompt to AI:", prompt);

                    // Call the Gemini API
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = {
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    "summary": { "type": "STRING" },
                                    "degradationPredictions": {
                                        "type": "ARRAY",
                                        "items": {
                                            "type": "OBJECT",
                                            "properties": {
                                                "asset": { "type": "STRING" },
                                                "prediction": { "type": "STRING" },
                                                "recommendation": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "maintenanceSchedule": {
                                        "type": "ARRAY",
                                        "items": {
                                            "type": "OBJECT",
                                            "properties": {
                                                "asset": { "type": "STRING" },
                                                "action": { "type": "STRING" },
                                                "urgency": { "type": "STRING" },
                                                "cost": { "type": "STRING" },
                                                "dueDate": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "scheduleConstraints": { "type": "STRING" }
                                },
                                "propertyOrdering": ["summary", "degradationPredictions", "maintenanceSchedule", "scheduleConstraints"]
                            }
                        }
                    };

                    const apiKey = ""; // Leave as empty string for Canvas to provide
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Check if the HTTP response itself was successful
                    if (!response.ok) {
                        const errorBody = await response.text();
                        // Tailor error message for 401 Unauthorized
                        if (response.status === 401) {
                            throw new Error(`Authentication Error (401 Unauthorized): Please ensure your API key is correctly configured and valid.`);
                        }
                        throw new Error(`HTTP error! status: ${response.status}, body: ${errorBody}`);
                    }

                    // First, get the raw response text to inspect it
                    rawResponseText = await response.text();
                    console.log("AI Raw Response Text (before JSON parsing):", rawResponseText);

                    if (rawResponseText.trim() === '') {
                        throw new Error("AI returned an empty response body.");
                    }

                    let result;
                    try {
                        // Attempt to parse the raw text as JSON
                        result = JSON.parse(rawResponseText);
                    } catch (parseError) {
                        console.error("Error parsing raw AI response text as JSON:", parseError);
                        aiGeneratedContentDiv.innerHTML = `
                            <div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-md mb-4" role="alert">
                                <p class="font-bold">AI Response Format Error</p>
                                <p>The AI returned invalid or incomplete JSON. Error: ${parseError.message}</p>
                                <p class="text-sm mt-2">Received: <code>${rawResponseText.substring(0, Math.min(rawResponseText.length, 500))}...</code></p>
                            </div>
                        `;
                        aiGeneratedContentDiv.classList.remove('hidden');
                        return; // Stop further processing if JSON is malformed
                    }

                    console.log("AI Parsed Response Object:", result); // Log the full parsed object

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const jsonTextFromParts = result.candidates[0].content.parts[0].text;
                        console.log("AI Response JSON Text from parts:", jsonTextFromParts); // Log the JSON string from parts

                        let parsedJson;
                        try {
                            parsedJson = JSON.parse(jsonTextFromParts);
                            displayAIResults(parsedJson);
                        } catch (innerParseError) {
                            console.error("Error parsing AI JSON response from content parts:", innerParseError);
                            aiGeneratedContentDiv.innerHTML = `
                                <div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-md mb-4" role="alert">
                                    <p class="font-bold">AI Content Format Error</p>
                                    <p>The AI's generated content was not valid JSON. Error: ${innerParseError.message}</p>
                                    <p class="text-sm mt-2">Received: <code>${jsonTextFromParts.substring(0, Math.min(jsonTextFromParts.length, 500))}...</code></p>
                                </div>
                            `;
                            aiGeneratedContentDiv.classList.remove('hidden');
                        }

                    } else {
                        aiGeneratedContentDiv.innerHTML = `
                            <div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-md mb-4" role="alert">
                                <p class="font-bold">AI Response Error</p>
                                <p>Could not get a valid response from the AI. The response structure was unexpected or content was missing from candidates.</p>
                            </div>
                        `;
                        aiGeneratedContentDiv.classList.remove('hidden');
                    }

                } catch (error) {
                    console.error("Error during AI analysis (outer catch):", error);
                    aiGeneratedContentDiv.innerHTML = `
                        <div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-md mb-4" role="alert">
                            <p class="font-bold">An Error Occurred</p>
                            <p>There was an error processing your request: ${error.message}. Please check your your API key or network connection.</p>
                        </div>
                    `;
                    aiGeneratedContentDiv.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden'); // Hide loading indicator
                }
            });

            // Simple custom alert function to replace window.alert
            function alert(message) {
                const existingAlert = document.getElementById('custom-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }

                const alertDiv = document.createElement('div');
                alertDiv.id = 'custom-alert';
                alertDiv.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
                alertDiv.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                        <p class="text-lg font-semibold text-gray-800 mb-4">${message}</p>
                        <button id="alert-ok-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">
                            OK
                        </button>
                    </div>
                `;
                document.body.appendChild(alertDiv);

                document.getElementById('alert-ok-button').addEventListener('click', () => {
                    alertDiv.remove();
                });
            }
        });
    </script>
</body>
</html>
